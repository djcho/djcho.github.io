---
title : "[SpringBoot][Chapter8.6] Spring Data JPA ν™μ© - JPA Auditing μ μ©ν•κΈ°"
categories:
- SpringBoot
tag :
- [SpringBoot, Spring, Java, Intelij, JPQL]
toc: true
toc_sticky : true
published : true
date : 2022-08-02
last_modified_at : 2022-08-02
---





μ¥μ •μ°λ‹μ΄ μ§€μ, [μ¤ν”„λ§λ¶€νΈ ν•µμ‹¬κ°€μ΄λ“ :: μ¤ν”„λ§ λ¶€νΈλ¥Ό ν™μ©ν• μ• ν”λ¦¬μΌ€μ΄μ… κ°λ° μ‹¤λ¬΄] μ±…μ„ μ½κ³  μ •λ¦¬ν• ν•„κΈ°μ…λ‹λ‹¤.π“Ά
{: .notice--warning}



## JPA Auditing μ μ©

JPAμ—μ„ 'Audit' μ΄λ€ 'κ°μ‹ν•λ‹¤'λΌλ” λ»μΌλ΅, κ° λ°μ΄ν„°λ§λ‹¤ 'λ„κ°€'', 'μ–Έμ ' λ°μ΄ν„°λ¥Ό μƒμ„±ν–κ³  λ³€κ²½ν–λ”μ§€ κ°μ‹ν•λ‹¤λ” μλ―Έλ΅ μ‚¬μ©λλ‹¤. μ•μ—μ„ μ‘μ„±ν• μ½”λ“λ¥Ό λ³΄λ©΄ μ• μ μλ“―μ΄ μ—”ν‹°ν‹° ν΄λμ¤μ—λ” κ³µν†µμ μΌλ΅ λ“¤μ–΄κ°€λ” ν•„λ“κ°€ μλ‹¤. μλ¥Ό λ“¤λ©΄ 'μƒμ„± μΌμ'μ™€ 'λ³€κ²½ μΌμ' κ°™μ€ κ²ƒμ΄λ‹¤. λ€ν‘μ μΌλ΅ λ§μ΄ μ‚¬μ©λλ” ν•„λ“λ” λ‹¤μκ³Ό κ°™λ‹¤.

- μƒμ„± μ£Όμ²΄
- μƒμ„± μΌμ
- λ³€κ²½ μ£Όμ²΄
- λ³€κ²½ μΌμ



μ΄λ¬ν• ν•„λ“λ“¤μ€ λ§¤λ² μ—”ν‹°ν‹°λ¥Ό μƒμ„±ν•κ±°λ‚ λ³€κ²½ν•  λ•λ§λ‹¤ κ°’μ„ μ£Όμ…ν•΄μ•Ό ν•λ” λ²κ±°λ΅μ›€μ΄ μλ‹¤. μ΄ κ°™μ€ λ²κ±°λ΅μ›€μ„ ν•΄μ†ν•κΈ° μ„ν•΄ Spring Data JPAμ—μ„λ” μ΄λ¬ν• κ°’μ„ μλ™μΌλ΅ λ„£μ–΄μ£Όλ” κΈ°λ¥μ„ μ κ³µν•λ‹¤. λ” μ§„ν–‰ν•κΈ°μ— μ•μ„ μ΄ κΈ°λ¥μ€ κΌ­ μ¶”κ°€ν•΄μ•Ό ν•λ” κΈ°λ¥μ€ μ•„λ‹μ§€λ§ 9μ¥λ¶€ν„°λ” μ΄ κΈ°λ¥μ΄ μ μ©λ μ—”ν‹°ν‹°λ¥Ό μ‚¬μ©ν•  μμ •μ΄λ―€λ΅ μ°Έκ³ ν•κΈ° λ°”λ€λ‹¤.



### JPA Auditing κΈ°λ¥ ν™μ„±ν™”

κ°€μ¥ λ¨Όμ € μ¤ν”„λ§ λ¶€νΈ μ• ν”λ¦¬μΌ€μ΄μ… Auditing κΈ°λ¥μ„ ν™μ„±ν™”ν•΄μ•Ό ν•λ‹¤. λ°©λ²•μ€ κ°„λ‹¨ν•λ‹¤. `main()` λ©”μ„λ“κ°€ μλ” ν΄λμ¤μ— μ•„λμ™€ κ°™μ΄ `@EnableJpaAuditing` μ–΄λ…Έν…μ΄μ…μ„ μ¶”κ°€ν•λ©΄ λλ‹¤.

<br>

```java
@SpringBootApplication
@EnableJpaAuditing
public class AdvancedJpaApplication {

    public static void main(String[] args) {
        SpringApplication.run(AdvancedJpaApplication.class, args);
    }

}
```

<br>

μ„μ™€ κ°™μ΄ μ–΄λ…Έν…μ΄μ…μ„ μ¶”κ°€ν•λ©΄ μ •μƒμ μΌλ΅ κΈ°λ¥μ΄ ν™μ„±ν™”λμ§€λ§ μ•μΌλ΅ λ‹¤λ£° λ‚΄μ©μΈ ν…μ¤νΈ μ½”λ“λ¥Ό μ‘μ„±ν•΄μ„ μ• ν”λ¦¬μΌ€μ΄μ…μ„ ν…μ¤νΈν•λ” μΌλ¶€ μƒν™©μ—μ„λ” μ¤λ¥κ°€ λ°μƒν•  μ μλ‹¤. μλ¥Ό λ“¤λ©΄, `@WebMvcTest` μ–΄λ…Έν…μ΄μ…μ„ μ§€μ •ν•΄μ„ ν…μ¤νΈλ¥Ό μν–‰ν•λ” μ½”λ“λ¥Ό μ‘μ„±ν•λ©΄ μ• ν”λ¦¬μΌ€μ΄μ… ν΄λμ¤λ¥Ό νΈμ¶ν•λ” κ³Όμ •μ—μ„ μμ™Έκ°€ λ°μƒν•  μ μλ‹¤. μ΄ κ°™μ€ λ¬Έμ λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ μ•„λμ™€ κ°™μ΄ λ³„λ„ `Configuration` ν΄λμ¤λ¥Ό μƒμ„±ν•΄μ„ μ• ν”λ¦¬μΌ€μ΄μ… ν΄λμ¤μ κΈ°λ¥κ³Ό λ¶„λ¦¬ν•΄μ„ ν™μ„±ν™”ν•  μ μλ‹¤. μ΄ μ±…μ—μ„λ” μ΄μ²λΌ `Configuration `ν΄λμ¤λ¥Ό λ³„λ„λ΅ μƒμ„±ν•λ” λ°©λ²•μ„ κ¶μ¥ν•λ‹¤.

<br>

```java
@Configuration
@EnableJpaAuditing
public class JpaAuditingConfiguration {
    
}
```

<br>

μ°Έκ³ λ΅ μ„μ™€ κ°™μ€ λ°©λ²•μ„ μ„ νƒν–λ‹¤λ©΄ μ•μ„  μμ  μ½”λ“μ—μ„ μ§€μ •ν• μ–΄λ…Έν…μ΄μ…μ€ μ§€μ›μ•Ό μ• ν”λ¦¬μΌ€μ΄μ…μ΄ μ •μƒμ μΌλ΅ λ™μ‘ν•λ‹¤.



### BaseEntity λ§λ“¤κΈ°

μ½”λ“μ μ¤‘λ³µμ„ μ—†μ• κΈ° μ„ν•΄μ„λ” κ° μ—”ν‹°ν‹°μ— κ³µν†µμΌλ΅ λ“¤μ–΄κ°€κ² λλ” μΉΌλΌ(ν•„λ“)μ„ ν•λ‚μ ν΄λμ¤λ΅ λΉΌλ” μ‘μ—…μ„ μν–‰ν•΄μ•Ό ν•λ‹¤.(λ°λ“μ‹ κ·Έλμ•Ό ν•λ” κ²ƒμ€ μ•„λ‹μ§€λ§ μμ£Ό ν™μ©λλ” κΈ°λ²•μ΄λ―€λ΅ μ°Έκ³ ν•΄λ‘ ν•„μ”κ°€ μλ‹¤.). μ•„μ§ μƒμ„± μ£Όμ²΄μ™€ λ³€κ²½ μ¶”μ λ” ν™μ©ν•  μΌμ΄ μ—†κΈ° λ•λ¬Έμ— μ μ™Έν•κ³  λ¨Όμ € μƒμ„± μΌμμ™€ λ³€κ²½μΌμλ§ μ¶”κ°€ν•΄μ„ μ•„λμ™€ κ°™μ΄ `BaseEntity`λ¥Ό μƒμ„±ν•λ‹¤.

<br>

```java
@Getter
@Setter
@ToString
@MappedSuperclass
@EntityListeners(AuditingEntityListener.class)
public class BaseEntity {

    @CreatedDate
    @Column(updatable = false)
    private LocalDateTime createdAt;

    @LastModifiedDate
    private LocalDateTime updatedAt;
}
```

<br>

μ—¬κΈ°μ„ μ‚¬μ©ν• μ£Όμ” μ–΄λ…Έν…μ΄μ…μ€ λ‹¤μκ³Ό κ°™λ‹¤.

- `@MappedSuperclass` : JPAμ μ—”ν‹°ν‹° ν΄λμ¤κ°€ μƒμ†λ°›μ„ κ²½μ° μμ‹ ν΄λμ¤μ—κ² λ§¤ν•‘ μ •λ³΄λ¥Ό μ „λ‹¬ν•λ‹¤.
- `@EntityListeners` : μ—”ν‹°ν‹°λ¥Ό λ°μ΄ν„°λ² μ΄μ¤μ— μ μ©ν•κΈ° μ „ν›„μ— μ½λ°±μ„ μ”μ²­ν•  μ μκ² ν•λ” μ–΄λ…Έν…μ΄μ…μ΄λ‹¤.
- `AuditingEntityListener` : μ—”ν‹°ν‹°μ Auditing μ •λ³΄λ¥Ό μ£Όμ…ν•λ” JPA μ—”ν‹°ν‹° λ¦¬μ¤λ„ ν΄λμ¤μ΄λ‹¤.
- `@CreatedDate` : λ°μ΄ν„° μƒμ„± λ‚ μ§λ¥Ό μλ™μΌλ΅ μ£Όμ…ν•λ” μ–΄λ…Έν…μ΄μ…μ΄λ‹¤.
- `@LastModifiedDate` : λ°μ΄ν„° μμ • λ‚ μ§λ¥Ό μλ™μΌλ΅ μ£Όμ…ν•λ” μ–΄λ…Έν…μ΄μ…μ΄λ‹¤.

μ„μ™€ κ°™μ΄ `BaseEntity`λ¥Ό μƒμ„±ν•κ³  `Product` μ—”ν‹°ν‹° ν΄λμ¤μ—μ„ κ³µν†µ μΉΌλΌμ„ μ κ±°ν•΄μ„ μ•„λμ™€ κ°™μ΄ μ½”λ“λ¥Ό μμ •ν•λ‹¤.

```java
@Entity
@Getter
@Setter
@NoArgsConstructor
@ToString
@EqualsAndHashCode(callSuper = true)
@Table(name = "product")
public class Product extends BaseEntity{
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long number;

    @Column(nullable = false)
    private String name;

    @Column(nullable = false)
    private Integer price;

    @Column(nullable = false)
    private Integer stock;
}
```

<br>

ν΄λμ¤μ— μ¶”κ°€ν•λ” μ–΄λ…Έν…μ΄μ…μ€ ν•„μ”μ— λ”°λΌ μ°¨μ΄κ°€ μμ„ μ μμΌλ‚ μ΄ μ±…μ—μ„λ” μ‹¤μµμ„ μ„ν•΄ μ—¬λ¬ μ–΄λ…Έν…μ΄μ…μ„ μ¶”κ°€ν–λ‹¤. κ·Έμ¤‘ `@ToString`, `@EqualsAndHashCode` μ–΄λ…Έν…μ΄μ…μ— μ μ©ν• `callSuper`μ†μ„±μ€ λ΅¬λ³µ μ„¤λ…μ—μ„ λ‹¤λ¤λ‹¤μ‹ν”Ό λ¶€λ¨ ν΄λμ¤μ ν•„λ“λ¥Ό ν¬ν•¨ν•λ” μ—­ν• μ„ μν–‰ν•λ‹¤.

μ΄λ ‡κ² μ„²μ–΄ν•λ©΄ κΈ°μ΅΄μ— ν…μ¤νΈν–λ κ²ƒμ²λΌ λ§¤λ² `LocalDateTime.now()` λ©”μ„λ“λ¥Ό μ‚¬μ©ν•΄ μ‹κ°„μ„ μ£Όμ…ν•μ§€ μ•μ•„λ„ μλ™μΌλ΅ κ°’μ΄ μƒμ„±λλ” κ²ƒμ„ λ³Ό μ μλ‹¤.

μ•„λμ™€ κ°™μ΄ ν…μ¤νΈ μ½”λ“λ¥Ό μ‘μ„±ν•΄μ„ μ‹¤ν–‰ν•λ‹¤.

<br>

```java
@Test
public void auditingTest(){
    Product product = new Product();
    product.setName("ν");
    product.setPrice(1000);
    product.setStock(100);

    Product savedProduct = productRepository.save(product);

    System.out.println("productName : " + savedProduct.getName());
    System.out.println("createdAt : " + savedProduct.getCreatedAt());
}
```

<br>

μ„ μμ μ—μ„λ” `Product` μ—”ν‹°ν‹°μ— μƒμ„±μΌμλ¥Ό μ…λ ¥ν•μ§€ μ•μ€ μƒνƒμ—μ„ λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥ν–λ‹¤. 10~11λ² μ¤„μ—μ„ μ¶λ ¥λ κ²°κ³Όλ” λ‹¤μκ³Ό κ°™λ‹¤.

```
productName : ν
createdAt : 2022-08-02T22:25:15.504550
```

<br>

μ§μ ‘ μΌμλ¥Ό κΈ°μ…ν•μ§€ μ•μ•μ§€λ§ μ •μƒμ μΌλ΅ λ°μ΄ν„°λ² μ΄μ¤μ—λ” μƒμ„±μΌμκ°€ μ €μ¥λμΌλ©°, μ—”ν‹°ν‹°μ ν•„λ“λ¥Ό μ¶λ ¥ν•΄λ³΄λ©΄ ν•΄λ‹Ή μ‹κ°„μ΄ μ¶λ ¥λλ” κ²ƒμ„ λ³Ό μ μλ‹¤.



> **π’΅ Tip.**
>
> JPA Auditing κΈ°λ¥μ—λ” `@CreatedBy`, `@ModifiedBy` μ–΄λ…Έν…μ΄μ…λ„ μ΅΄μ¬ν•λ‹¤. λ„κ°€ μ—”ν‹°ν‹°λ¥Ό μƒμ„±ν–κ³  μμ •ν–λ”μ§€ μλ™μΌλ΅ κ°’μ„ μ£Όμ…ν•λ” κΈ°λ¥μ΄λ‹¤. μ΄ κΈ°λ¥μ„ μ‚¬μ©ν•λ ¤λ©΄ `AuditorAware`λ¥Ό μ¤ν”„λ§ λΉμΌλ΅ λ“±λ΅ν•  ν•„μ”κ°€ μλ‹¤.



### μ •λ¦¬

μ΄λ² μ¥μ—μ„λ” ORMμ κ°λ…μ„ μ•μ•„λ³΄κ³  μλ°”μ ν‘μ¤€ ORM κΈ°μ  μ¤ν™μΈ JPAλ¥Ό μ‚΄ν΄λ΄¤λ‹¤. λ°μ΄ν„°λ¥Ό λ‹¤λ£¨λ” μμ—­μ€ μ• ν”λ¦¬μΌ€μ΄μ…μ„ κ°λ°ν•λ©΄μ„ κ°€μ¥ μ¤‘μ”ν• λ¶€λ¶„μ΄λ‹¤. λ€λ¶€λ¶„μ λ΅μ§μ€ λ°μ΄ν„°λ¥Ό κ°€κ³µν•΄μ„ λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥ν•κ±°λ‚ κ°’μ„ ν¨μ¨μ μΌλ΅ κ°€μ Έμ¤λ” λ¶€λ¶„μ΄ μ¤‘μ”ν•λ‹¤. λ”°λΌμ„ μ΄λ² μ¥μ—μ„ λ‹¤λ£¬ κΈ°λ³ΈκΈ°λ¥Ό μ λ‹¤μ Έλ³΄κ³  λ νΌλ°μ¤ λ­μ„λ„ μ‚΄ν΄λ³΄λ©΄μ„ λ‹¤μ–‘ν• μμ λ¥Ό μ¤μ¤λ΅ λ§λ“¤μ–΄ λ³΄λ” κ²ƒμ΄ μ¤‘μ”ν•λ‹¤.
