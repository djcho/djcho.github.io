---
title : "[JPA] ì—°ê´€ê´€ê³„ ì‚¬ìš©"
categories:
- JPA
tag :
- [Java, ORM, JPA, Hibernate, Relationship]
toc: true
toc_sticky : true
published : true
date : 2023-01-10 01:00:00
last_modified_at : 2023-01-10 01:00:00
---

ê¹€ì˜í•œë‹˜ì´ ì§€ìŒ, [ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë°] ì±…ì„ ì½ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤.ğŸ“¢
{: .notice--warning}

# ì—°ê´€ê´€ê³„ ì‚¬ìš©

## ì €ì¥

```java
public void testSave(EntityManager em){
    //íŒ€1 ì €ì¥
    Team team1 = new Team("team1", "íŒ€1");
    em.persist(team1);

    //íšŒì›1 ì €ì¥
    Member member1 = new Member("member1", "íšŒì›1");
    member1.setTeam(team1); //ì—°ê´€ê´€ê³„ ì„¤ì • member1 -> team1

    //íšŒì›2 ì €ì¥
    Member member2 = new Member("member2", "íšŒì›2");
    member2.setTeam(team1); //ì—°ê´€ê´€ê³„ ì„¤ì • member2 -> team1
    em.persist(member2);
}
```

âš ï¸ JPAì—ì„œ ì—”í‹°í‹°ë¥¼ ì €ì¥í•  ë•Œ ì—°ê´€ëœ ëª¨ë“  ì—”í‹°í‹°ëŠ” ì˜ì† ìƒíƒœì—¬ì•¼ í•œë‹¤.
{: .notice--warning}



**ì¶œë ¥ëœ SQL**

```sql
Hibernate: 
    /* insert org.example.Team
        */ insert 
        into
            Team
            (name, TEAM_ID) 
        values
            (?, ?)
Hibernate: 
    /* insert org.example.Member
        */ insert 
        into
            Member
            (TEAM_ID, NAME, MEMBER_ID) 
        values
            (?, ?, ?)
Hibernate: 
    /* insert org.example.Member
        */ insert 
        into
            Member
            (TEAM_ID, NAME, MEMBER_ID) 
        values
            (?, ?, ?)
```



**ê²°ê³¼**

<p align="center">
  <img alt="img-name" src="https://user-images.githubusercontent.com/13410737/211595824-f4f14ff6-1c7c-4b15-9c5c-ae61b28369aa.png">
  <br>
    <em>ê²°ê³¼</em>
</p>



## ì¡°íšŒ

ì—°ê´€ê´€ê³„ê°€ ìˆëŠ” ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ëŠ” ë°©ë²• 2ê°€ì§€

1. ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰(ê°ì²´ ì—°ê´€ê´€ê³„ë¥¼ ì‚¬ìš©í•œ ì¡°íšŒ)
2. ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì‚¬ìš©(JPQL)



### ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰

```java
Member member = em.find(Member.class, "member1");
Team team = member.getTeam(); //ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰
System.out.println("íŒ€ ì´ë¦„ = " + team.getName());

//ì¶œë ¥ ê²°ê³¼ : íŒ€ ì´ë¦„=íŒ€1
```



### ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì‚¬ìš©(JPQL)

```java
private static void queryLogicJoin(EntityManager em){
    String jpql = "select m from Member m join m.team t where t.name=:teamName";

    List<Member> resultList = em.createQuery(jpql, Member.class)
        .setParameter("teamName", "íŒ€1")
        .getResultList();

    for(Member member : resultList){
        System.out.println("[query] member.username=" + member.getUsername());
    }
}

//ì¶œë ¥ ê²°ê³¼
//[query] member.username=íšŒì›1
//[query] member.username=íšŒì›2
```

**ì¶œë ¥ëœ SQL**

```sql
Hibernate: 
    /* select
        m 
    from
        Member m 
    join
        m.team t 
    where
        t.name=:teamName */ select
            member0_.MEMBER_ID as member_i1_0_,
            member0_.TEAM_ID as team_id8_0_,
            member0_.NAME as name7_0_ 
        from
            Member member0_ 
        inner join
            Team team1_ 
                on member0_.TEAM_ID=team1_.TEAM_ID 
        where
            team1_.name=?
```



## ìˆ˜ì •

```java
private static void updateRelation(EntityManager em){
    //ìƒˆë¡œìš´ íŒ€2
    Team team2 = new Team("team2", "íŒ€2");
    em.persist(team2);

    //íšŒì›1ì— ìƒˆë¡œìš´ íŒ€2 ì„¤ì •
    Member member = em.find(Member.class, "member1");
    member.setTeam(team2);
}
```

**ì¶œë ¥ëœ SQL**

```sql
Hibernate: 
    /* update
        org.example.Member */ update
            Member 
        set
            TEAM_ID=?,
            NAME=? 
        where
            MEMBER_ID=?
```



## ì—°ê´€ê´€ê³„ ì œê±°

```java
private static void deleteRelation(EntityManager em){
    Member member1 = em.find(Member.class, "member1");
    member1.setTeam(null);
}
```

**ì¶œë ¥ëœ SQL**

```sql
Hibernate: 
    /* update
        org.example.Member */ update
            Member 
        set
            TEAM_ID=?,
            NAME=? 
        where
            MEMBER_ID=?
```



## ì—°ê´€ëœ ì—”í‹°í‹° ì‚­ì œ

ì—°ê´€ ì—í‹°í‹°ë¥¼ ì‚­ì œí•˜ë ¤ë©´ ê¸°ì¡´ì— ìˆë˜ ì—°ê´€ê´€ê³„ë¥¼ ë¨¼ì € ì œê±°í•˜ê³  ì‚­ì œí•´ì•¼ í•¨, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì œì•½ì¡°ê±´ ìœ„ë°˜ ì—ëŸ¬ê°€ ë°œìƒí•¨

```java
member1.setTeam(null); //íšŒì›1 ì—°ê´€ê´€ê³„ ì œê±°
member2.setTeam(null); //íšŒì›2 ì—°ê´€ê´€ê³„ ì œê±°
em.remove(team);
```

