---
title : "[JPA] JPA ì‹œì‘í•˜ê¸°#2"
categories:
- JPA
tag :
- [Java, ORM, JPA]
toc: true
toc_sticky : true
published : true
date : 2022-12-26 00:00:00
last_modified_at : 2022-12-26 00:00:00
---





ê¹€ì˜í•œë‹˜ì´ ì§€ìŒ, [ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë°] ì±…ì„ ì½ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤.ğŸ“¢
{: .notice--warning}



# JPA ì‹œì‘í•˜ê¸°

## ì†ŒìŠ¤ ì½”ë“œ

```java
//JPA ì‹œì‘ ì½”ë“œ
package org.example;

import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;
import javax.persistence.EntityTransaction;
import javax.persistence.Persistence;
import java.util.List;

public class Main {
    public static void main(String[] args) {
        //[ì—”í‹°í‹° ë§¤ë‹ˆì € íŒ©í† ë¦¬] - ìƒì„±
        EntityManagerFactory emf = Persistence.createEntityManagerFactory("hellojpa");
        //[ì—”í‹°í‹° ë§¤ë‹ˆì €] - ìƒì„±
        EntityManager em = emf.createEntityManager();
        //[íŠ¸ëœì­ì…˜] - íšë“
        EntityTransaction tx = em.getTransaction();

        try{
            tx.begin();     //[íŠ¸ëœì­ì…˜] - ì‹œì‘
            logic(em);      //ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰
            tx.commit();    //[íŠ¸ëœì­ì…˜] - ì»¤ë°‹
        }catch (Exception e){
            tx.rollback();  //[íŠ¸ëœì­ì…˜] - ë¡¤ë°±
        }
        finally {
            em.close();     //[ì—”í‹°í‹° ë§¤ë‹ˆì €] - ì¢…ë£Œ
        }
        emf.close();        //[ì—”í‹°í‹° ë§¤ë‹ˆì € íŒ©í† ë¦¬] - ì¢…ë£Œ
    }

    //ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
    private static void logic(EntityManager em){
        String id = "id1";
        Member member = new Member();
        member.setId(id);
        member.setUsername("ì˜ˆë‚˜");
        member.setAge(3);

        //ë“±ë¡
        em.persist(member);

        //ìˆ˜ì •
        member.setAge(20);

        //í•œ ê±´ ì¡°íšŒ
        Member findMember = em.find(Member.class, id);
        System.out.println("findMember=" + findMember.getUsername() + ", age=" + findMember.getAge());

        //ëª©ë¡ ì¡°íšŒ
        List<Member> members = em.createQuery("select m from Member m", Member.class)
                .getResultList();
        System.out.println("members.size=" + members.size());

        //ì‚­ì œ
        em.remove(member);
    }
}
```

ì½”ë“œëŠ” í¬ê²Œ 3ë¶€ë¶„ìœ¼ë¡œ ë‚˜ë‰˜ì–´ ìˆë‹¤

- ì—”í‹°í‹° ë§¤ë‹ˆì € ì„¤ì •
- íŠ¸ëœì­ì…˜ ê´€ë¦¬
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§



## ì—”í‹°í‹° ë§¤ë‹ˆì € ì„¤ì •

<p align="center">
  <img alt="img-name" src="https://user-images.githubusercontent.com/13410737/210161018-f4985fb6-525d-42ca-be7d-ddb8fd161d61.png">
  <br>
    <em>ì—”í‹°í‹° ë§¤ë‹ˆì € ìƒì„± ê³¼ì •</em>
</p>

### ì—”í‹°í‹° ë§¤ë‹ˆì € íŒ©í† ë¦¬ ìƒì„±

```java
        EntityManagerFactory emf = Persistence.createEntityManagerFactory("hellojpa");
```

- META-INF/persistence.xml ì˜ ì„¤ì • ì •ë³´ë¥¼ ì‚¬ìš©í•´ì„œ ì—”í‹°í‹° ë§¤ë‹ˆì € íŒ©í† ë¦¬ë¥¼ ìƒì„±í•œë‹¤. 
- `hellojpa`ì˜ ì´ë¦„ì˜ `persistence-unit` ì„ ì°¾ì•„ì„œ ì—”í‹°í‹° ë§¤ë‹ˆì €ê°€ ìƒì„±ëœë‹¤.
- ì—”í‹°í‹° ë§¤ë‹ˆì € íŒ©í† ë¦¬ëŠ” JPA êµ¬í˜„ì²´ì— ë”°ë¼ ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ í’€ë„ ìƒì„±í•˜ë¯€ë¡œ ì—”í‹°í‹° ë§¤ë‹ˆì € íŒ©í† ë¦¬ì˜ ìƒì„± ë¹„ìš©ì€ ì•„ì£¼ í¼
- ë•Œë¬¸ì— **<u>ì—”í‹°í‹° ë§¤ë‹ˆì € íŒ©í† ë¦¬ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ì—ì„œ ë”± í•œ ë²ˆë§Œ ìƒì„±í•˜ê³  ê³µìœ í•´ì„œ ì‚¬ìš©í•´ì•¼ í•¨</u>**

### ì—”í‹°í‹° ë§¤ë‹ˆì € ìƒì„±

```java
EntityManager em = emf.createEntityManager();
```

- JPAì˜ ê¸°ëŠ¥ ëŒ€ë¶€ë¶„ì€ ì—”í‹°í‹° ë§¤ë„ˆì§€ê°€ ì œê³µ
- **<u>ì—”í‹°í‹° ë§¤ë‹ˆì €ë¥¼ ì‚¬ìš©í•´ì„œ ì—”í‹°í‹°ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ë“±ë¡/ìˆ˜ì •/ì‚­ì œ/ì¡°íšŒ ê°€ëŠ¥</u>**
- ì—”í‹°í‹° ë§¤ë‹ˆì €ëŠ” ë‚´ë¶€ì— DataSource(ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜)ë¥¼ ìœ ì§€í•˜ë©´ì„œ ë°ì´í„°ë² ì´ìŠ¤ì™€ í†µì‹ 
- **<u>ì—”í‹°í‹° ë§¤ë‹ˆì €ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ê³¼ ë°€ì ‘í•œ ê´€ê³„ê°€ ìˆìœ¼ë¯€ë¡œ ìŠ¤ë ˆë“œê°„ ê³µìœ í•˜ê±°ë‚˜ ì¬ì‚¬ìš©í•˜ë©´ ì•ˆë¨</u>**



## íŠ¸ëœì­ì…˜ ê´€ë¦¬

```java
EntityTransaction tx = em.getTransaction(); //íŠ¸ëœì­ì…˜ API
try{
  tx.begin();     //íŠ¸ëœì­ì…˜ ì‹œì‘
  logic(em);      //ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰
  tx.commit();    //íŠ¸ëœì­ì…˜ ì»¤ë°‹
}catch (Exception e){
  tx.rollback();  //ì˜ˆì™¸ ë°œìƒ ì‹œ íŠ¸ëœì­ì…˜ ë¡¤ë°±
}
```

- JPAë¥¼ ì‚¬ìš©í•˜ë©´ í•­ìƒ íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ ë°ì´í„°ë¥¼ ë³€ê²½í•´ì•¼ í•¨
- íŠ¸ëœì­ì…˜ ì—†ì´ ë°ì´í„°ë¥¼ ë³€ê²½í•˜ë©´ ì˜ˆì™¸ê°€ ë°œìƒ í•¨



## ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§

íšŒì› ì—”í‹°í‹°ë¥¼ í•˜ë‚˜ ìƒì„±í•œ ë‹¤ìŒ ì—”í‹°í‹° ë§¤ë‹ˆì €ë¥¼ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ì— ë“±ë¡, ìˆ˜ì •, ì‚­ì œ, ì¡°íšŒí•œë‹¤. ì¶œë ¥ ê²°ê³¼ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

```
findMember=ì˜ˆë‚˜, age=20
members.size=1
```

### ë“±ë¡

```java
String id = "id1";
Member member = new Member();
member.setId(id);
member.setUsername("ì˜ˆë‚˜");
member.setAge(3);

//ë“±ë¡
em.persist(member);
```

- ì—”í‹°í‹°ë¥¼ ì €ì¥í•˜ë ¤ë©´ `persist()` ë©”ì†Œë“œì— ì €ì¥í•  ì—”í‹°í‹°ë¥¼ ì „ë‹¬

- JPAëŠ” íšŒì› ì—”í‹°í‹°ì˜ ë§¤í•‘ ì •ë³´(ì–´ë…¸í…Œì´ì…˜)ë¥¼ ë¶„ì„í•´ì„œ ì•„ë˜ì™€ ê°™ì€ SQLì„ ë§Œë“¤ì–´ ë°ì´í„°ë² ì´ìŠ¤ì— ì „ë‹¬

    ```sql
    INSERT INTO MEMBER (age, NAME, ID) VALUES ('id1', 'ì˜ˆë‚˜', 2)
    ```

    

### ì¡°íšŒ

````java
//ìˆ˜ì •
member.setAge(20);
````

- JPAëŠ” ì–´ë–¤ ì—”í‹°í‹°ê°€ ë³€ê²½ë˜ì—ˆëŠ”ì§€ ì¶”ì í•˜ëŠ” ê¸°ëŠ¥ ì¡´ì¬

- ì—”í‹°í‹°ì˜ ê°’ë§Œ ë³€ê²½í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ UPDATE SQLì„ ìƒì„±í•´ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ì „ë‹¬(`em.update()`ë¼ëŠ” ë©”ì†ŒìŠ¤ ì¡´ì¬X)

    ```sql
    UPDATE MEMBER SET AGE=20, NAME='ì˜ˆë‚˜' WHERE ID='id1'
    ```



### ì‚­ì œ

```java
em.remove(member);
```

- ì—”í‹°í‹°ë¥¼ ì‚­ì œí•˜ë ¤ë©´ ì—”í‹°í‹° ë§¤ë‹ˆì €ì˜ `remove()` ë©”ì†Œë“œì— ì‚­ì œí•˜ë ¤ëŠ” ì—”í‹°í‹°ë¥¼ ì „ë‹¬

- JPAëŠ” ë‹¤ìŒ DELETE SQLì„ ì‹¤í–‰ í•¨

    ```sql
    DELETE FROM MEMBER WHERE ID = 'id1'
    ```



### í•œ ê±´ ì¡°íšŒ

```java
Member member = em.find(Member.class, id);
```

- `find()` ë©”ì†Œë“œëŠ” `@Id`ë¡œ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ì™€ ë§¤í•‘í•œ ì‹ë³„ì ê°’ìœ¼ë¡œ ì—”í‹°í‹° í•˜ë‚˜ë¥¼ ì¡°íšŒí•˜ëŠ” ê°€ì¥ ë‹¨ìˆœí•œ ì¡°íšŒ

- JPAëŠ” ë‹¤ìŒ SELECT SQLì„ ìƒì„±í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì— ì „ë‹¬

    ```sql
    SELECT * FROM MEMBER WHERE ID='id1'
    ```



## JPQL

JPAëŠ” SQLì„ ì¶”ìƒí™”í•œ JPQLì´ë¼ëŠ” ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ë¥¼ ì œê³µ í•œë‹¤.

```java
//ëª©ë¡ ì¡°íšŒ
TypedQuery<Member> query = em.createQuery("select m from Menmber m", Member.class);
List<Member> members = query.getResultList();
```

- JPAëŠ” ì—”í‹°í‹° ê°ì²´ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ê°œë°œí•˜ë¯€ë¡œ ê²€ìƒ‰ì„ í•  ë•Œë„ í…Œì´ë¸”ì´ ì•„ë‹Œ ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê²€ìƒ‰í•´ì•¼ í•˜ëŠ”ë° ì‚¬ì‹¤ìƒ <u>ë¶ˆê°€ëŠ¥</u>
- JPAëŠ” JPQL(Java Persistence Query Language)ì´ë¼ëŠ” ì¿¼ë¦¬ ì–¸ì–´ë¡œ ë¬¸ì œ í•´ê²°



**JPQLê³¼ SQLì˜ ì°¨ì´ì **

- JPQL : **<u>ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒ</u>**ìœ¼ë¡œ ì¿¼ë¦¬(í´ë˜ìŠ¤ì™€ í•„ë“œë¥¼ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬)
- SQL : **<u>ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì„ ëŒ€ìƒ</u>**ìœ¼ë¡œ ì¿¼ë¦¬

`select m from Member m`ì˜ `Member`ëŠ” íšŒì› ì—”í‹°í‹° ê°ì²´ë¥¼ ë§í•˜ëŠ” ê²ƒ, MEMBER í…Œì´ë¸”X => **<u>JPQLì€ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì„ ì „í˜€ ì•Œì§€ ëª»í•œë‹¤.</u>**

JPAëŠ” JPQLì„ ë¶„ì„í•´ì„œ ì•„ë˜ì™€ ê°™ì€ ì ì ˆí•œ SQLì„ ë§Œë“¤ì–´ ë°ì´í„°ë² ì´ìŠ¤ì— ì „ë‹¬

```sql
SELECT M.ID, M.NAME, M.AGE FROM MEMBER M
```

