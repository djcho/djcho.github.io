---
title : "[JPA] ì¼ëŒ€ë‹¤"
categories:
- JPA
tag :
- [Java, ORM, JPA, Hibernate, Relationship, OneToMany]
toc: true
toc_sticky : true
published : true
date : 2023-01-15 02:00:00
last_modified_at : 2023-01-15 02:00:00
---

ê¹€ì˜í•œë‹˜ì´ ì§€ìŒ, [ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë°] ì±…ì„ ì½ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤.ğŸ“¢
{: .notice--warning}



# ì¼ëŒ€ë‹¤

- ì¼ëŒ€ë‹¤ ê´€ê³„ëŠ” ë‹¤ëŒ€ì¼ ê´€ê³„ì˜ ë°˜ëŒ€ ë°©í–¥ì´ë‹¤.
- ì¼ëŒ€ë‹¤ ê´€ê³„ëŠ” ì—”í‹°í‹°ë¥¼ í•˜ë‚˜ ì´ìƒ ì°¸ì¡°í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì»¬ë ‰ì…˜(`Collection`, `List`, `Set`, `Map`) ì¤‘ í•˜ë‚˜ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.



## ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥[1:N]

í•˜ë‚˜ì˜ íŒ€ì€ ì—¬ëŸ¬ íšŒì›ì„ ì°¸ì¡°í•  ìˆ˜ ìˆëŠ”ë° íŒ€ì€ íšŒì›ë“¤ì„ ì°¸ì¡°í•˜ì§€ë§Œ ë°˜ëŒ€ë¡œ íšŒì›ì€ íŒ€ì„ ì°¸ì¡°í•˜ì§€ ì•ŠëŠ” ê²½ìš° : ì¼ëŒ€ë‹¤

<p align="center">
  <img alt="img-name" src="https://user-images.githubusercontent.com/13410737/218317624-872604d1-ba7c-4ad9-9042-204a2d84ff06.png">
  <br>
    <em>ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥</em>
</p>

- ë³´í†µ ìì‹ ì´ ë§¤í•‘í•œ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•˜ëŠ”ë°, ì´ ë§¤í•‘ì€ ë°˜ëŒ€ìª½ í…Œì´ë¸”ì— ìˆëŠ” ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•˜ì—¬ íŠ¹ì´í•œ ëª¨ìŠµì´ ë‚˜íƒ€ë‚¨
- `@JoinColumn`ì„ ëª…ì‹œí•´ì•¼ í•¨, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ JPAëŠ” ì—°ê²° í…Œì´ë¸”ì„ ì¤‘ê°„ì— ë‘ê³  ì—°ê´€ê´€ê³„ë¥¼ ê´€ë¦¬í•˜ëŠ” ì¡°ì¸ í…Œì´ë¸” ì „ëµì„ ì‚¬ìš©

```java
@Entity
public class Team{
    @Id @GeneratedValue
    @Column(name = "TEAM_ID")
    private Long id;

    private String name;

    @OneToMany
    @JoinColumn(name = "TEAM_ID") // MEMBER í…Œì´ë¸”ì˜ TEAM_ID (FK)
    private List<Memeber> members = new ArrayList<Member>();

    //Getter, Setter ...
}
```

```java
@Entity
public class Member{
    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;

    private String username;

    //Getter, Setter ...
}
```



### ë‹¨ì 

ë§¤í•‘í•œ ê°ì²´ê°€ ê´€ë¦¬í•˜ëŠ” ì™¸ë˜ í‚¤ê°€ ë‹¤ë¥¸ í…Œì´ë¸”ì— ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— ì—°ê´€ê´€ê³„ ì²˜ë¦¬ë¥¼ ìœ„í•œ <u>**ì¶”ê°€ UPDATE SQLì´ ì‹¤í–‰ ë¨**</u>

```java
public static void testSave(EntityManager em){
    Member member1 = new Member("member1", "íšŒì›1");
    Member member2 = new Member("member2", "íšŒì›2");

    Team team1 = new Team("team1", "íŒ€1");
    team1.getMembers().add(member1);
    team1.getMembers().add(member2);

    em.persist(member1);//INSERT-member1
    em.persist(member2);//INSERT-member2
    em.persist(team1);  //INSERT-team1, UPDATE-member1.fk,
                        //UPDATE-member2.fk
}
```

```
Hibernate: 
    /* insert org.example.Member
        */ insert 
        into
            Member
            (age, createdDate, description, lastModifiedDate, roleType, NAME, MEMBER_ID) 
        values
            (?, ?, ?, ?, ?, ?, ?)
Hibernate: 
    /* insert org.example.Member
        */ insert 
        into
            Member
            (age, createdDate, description, lastModifiedDate, roleType, NAME, MEMBER_ID) 
        values
            (?, ?, ?, ?, ?, ?, ?)
Hibernate: 
    /* insert org.example.Team
        */ insert 
        into
            Team
            (name, TEAM_ID) 
        values
            (?, ?)
Hibernate: 
    /* create one-to-many row org.example.Team.members */ update
        Member 
    set
        TEAM_ID=? 
    where
        MEMBER_ID=?
Hibernate: 
    /* create one-to-many row org.example.Team.members */ update
        Member 
    set
        TEAM_ID=? 
    where
        MEMBER_ID=?
```

- `Member` ì—”í‹°í‹°ëŠ” `Team` ì—”í‹°í‹°ë¥¼ ëª¨ë¥´ê³ , ì—°ê´€ê´€ê³„ì— ëŒ€í•œ ì •ë³´ëŠ” `Team`ì—”í‹°í‹°ì˜ `members`ê°€ ê´€ë¦¬í•˜ë¯€ë¡œ `Member` ì—”í‹°í‹°ë¥¼ ì €ì¥í•  ë•ŒëŠ” MEMBER í…Œì´ë¸”ì˜ TEAM_ID ì™¸ë˜ í‚¤ì—ëŠ” ì•„ë¬´ ê°’ë„ ì €ì¥ë˜ì§€ ì•ŠìŒ
- `Team` ì—”í‹°í‹°ë¥¼ ì €ì¥í•  ë•Œ `Team.members`ì˜ ì°¸ì¡° ê°’ì„ í™•ì¸í•´ì„œ íšŒì› í…Œì´ë¸”ì˜ ìˆëŠ” TEAM_ID ì™¸ë˜ í‚¤ë¥¼ ì—…ë°ì´íŠ¸
- <u>ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ë³´ë‹¤ëŠ” ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ ë§¤í•‘ì„ ì‚¬ìš©í•´ì•¼ í•¨</u>
    - ì„±ëŠ¥ ë¬¸ì œë„ ìˆê³  ê´€ë¦¬ í¬ì¸íŠ¸ë„ ëŠ˜ì–´ ë‚¨
    - ë§¤í•‘ í…Œì´ë¸”ì˜ ëª¨ì–‘ë˜í•œ ì™„ì „íˆ ë™ì¼í•˜ê³  ì—”í‹°í‹°ë§Œ ì•½ê°„ ìˆ˜ì • í•´ë‹¹ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆëŠ” ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ ë§¤í•‘ì„ ì‚¬ìš© ê¶Œì¥



## ì¼ëŒ€ë‹¤ ì–‘ë°©í–¥[1:N, N:1]

- <u>ì¼ëŒ€ë‹¤ ì–‘ë°©í–¥ì€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ</u>
    - `@OneToMany`ëŠ” ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ë  ìˆ˜ ì—†ìŒ
    - ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ íŠ¹ì„±ìƒ ì¼ëŒ€ë‹¤, ë‹¤ëŒ€ì¼ ê´€ê³„ëŠ” í•­ìƒ ë‹¤ ìª½ì— ì™¸ë˜ í‚¤ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— `@OneToMany`, `@ManyToOne` ë‘˜ ì¤‘ì— ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ í•­ìƒ ë‹¤ ìª½ì¸ `@ManyToOne`ì„ ì‚¬ìš©
    - ë•Œë¬¸ì— `@ManyToOne` ì—ëŠ” `mappedBy` ì†ì„±ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŒ

ê·¸ëŸ¼ì—ë„ ì–‘ë°©í–¥ì„ êµ¬í˜„í•´ì•¼ í•  ê²½ìš°ì—” ë‹¤ëŒ€ì¼ ë‹¨ë°©í–¥ ë§¤í•‘ì„ ì½ê¸° ì „ìš©ìœ¼ë¡œ ì¶”ê°€í•˜ë©´ ê°€ëŠ¥, <u>But. ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ì´ ê°€ì§€ëŠ” ë‹¨ì ì€ í•´ê²° ë¶ˆê°€ëŠ¥</u>

<p align="center">
  <img alt="img-name" src="https://user-images.githubusercontent.com/13410737/218319377-ad68ce7f-7c99-4a8a-9188-cb4222d85e8c.png">
  <br>
    <em>ì¼ëŒ€ë‹¤ ì–‘ë°©í–¥</em>
</p>

```java
@Entity
public class Team {
    @Id @GeneratedValue
    @Column(name = "TEAM_ID")
    private Long id;

    private String name;

    @OneToMany
    @JoinColumn(name = "TEAM_ID")
    private List<Member> members = new ArrayList<Member>();

    //Getter, Setter ...
}
```

```java
@Entity
public class Member {
    @Id @generatedValue
    @Column(name = "MEMBER_ID")
    private Long id;
    private String username;

    @ManyToOne
    @JoinColumn(name = "TEAM_ID", insertable = false, updatable = false)
    private Team team;

    //Getter, Setter ...
}
```

- ì¼ëŒ€ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ê³¼ ê°™ì€ TEAM_ID ì™¸ë˜ í‚¤ ì»¬ëŸ¼ì„ ë§¤í•‘í–ˆì§€ë§Œ ì´ë ‡ê²Œ ë˜ë©´ ë‘˜ ë‹¤ ê°™ì€ í‚¤ë¥¼ ê´€ë¦¬í•˜ë¯€ë¡œ ë¬¸ì œ ë°œìƒ ê°€ëŠ¥
    - ë‹¤ëŒ€ì¼ ìª½ì€ `insertable = false`, `updatable = false` ë¡œ ì„¤ì •í•´ì„œ ì½ê¸° ì „ìš©ìœ¼ë¡œ ì„¤ì • í•´ì•¼ í•¨
