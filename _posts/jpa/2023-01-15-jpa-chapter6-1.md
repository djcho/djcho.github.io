---
title : "[JPA] ë‹¤ëŒ€ì¼"
categories:
- JPA
tag :
- [Java, ORM, JPA, Hibernate, Relationship, ManyToOne]
toc: true
toc_sticky : true
published : true
date : 2023-01-15 01:00:00
last_modified_at : 2023-01-15 01:00:00
---

ê¹€ì˜í•œë‹˜ì´ ì§€ìŒ, [ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë°] ì±…ì„ ì½ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤.ğŸ“¢
{: .notice--warning}



# ë‹¤ëŒ€ì¼

- ë‹¤ëŒ€ì¼ ê´€ê³„ì˜ ë°˜ëŒ€ ë°©í–¥ì€ í•­ìƒ ì¼ëŒ€ë‹¤, ì¼ëŒ€ë‹¤ ê´€ê³„ì˜ ë°˜ëŒ€ ë°©í–¥ì€ í•­ìƒ ë‹¤ëŒ€ì¼
- ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì˜ ì¼(1), ë‹¤(N) ê´€ê³„ì—ì„œ ì™¸ë˜ í‚¤ëŠ” í•­ìƒ **'ë‹¤'**ìª½ì— ìˆìŒ
- ê°ì²´ ì–‘ë°©í–¥ ê´€ê³„ì—ì„œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ í•­ìƒ **'ë‹¤'**ìª½ì´ì–´ì•¼ í•¨



## ë‹¤ëŒ€ì¼ ë‹¨ë°©í–¥[N:1]

ì—¬ëŸ¬ íšŒì›ì´ í•˜ë‚˜ì˜ íŒ€ì„ ì°¸ì¡°í•˜ê³ , íšŒì›ë“¤ì€ íŒ€ì„ ì°¸ì¡°í•˜ì§€ë§Œ ë°˜ëŒ€ë¡œ íŒ€ì€ íšŒì›ì„ ì°¸ì¡°í•˜ì§€ ì•ŠëŠ” ê²½ìš° : ë‹¤ëŒ€ì¼ ê´€ê³„

<p align="center">
  <img alt="img-name" src="https://user-images.githubusercontent.com/13410737/212549567-9b6aeefd-9496-49ea-8e17-6e801651d5c3.png">
  <br>
    <em>ë‹¤ëŒ€ì¼ ë‹¨ë°©í–¥</em>
</p>

```java
@Entity
public class Member{
    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;

    private String username;

    @ManyToOne
    @JoinColumn(name = "TEAM_ID")
    private Team team;

    //Getter, Setter ...
    ...
}
```

```java
@Entity
public class Team{
    @Id @GeneratedValue
    @Column(name = "TEAM_ID")
    private Long id;

    private String name;

    //Getter, Setter ...
    ...
}
```



## ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥[N:1, 1:N]

<p align="center">
  <img alt="img-name" src="https://user-images.githubusercontent.com/13410737/212549921-f90a9b1b-d6b2-44c8-b6e3-a0a5ac241305.png">
  <br>
    <em>ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥</em>
</p>

- ì‹¤ì„ ì´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸(`Member.team`)ì´ê³  ì ì„ (`Team.members`)ì€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ì•„ë‹ˆë‹¤.

```java
@Entity
public class Member {
    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;

    private String username;

    @ManyToOne
    @JoinColumn(name= "TEAM_ID")
    private Team team;

    public void setTeam(Team team) {
        this.team = team;

        //ë¬´í•œë£¨í”„ì— ë¹ ì§€ì§€ ì•Šë„ë¡ ì²´í¬
        if(!team.getMembers().contains(this)){
            team.getMembers().add(this);
        }
    }
}
```

```java
@Entity
public class Team {
    @Id @GeneratedValue
    @Column(name = "TEAM_ID")
    private Long id;

    private String name;

    @OneToMany(mappedBy = "team")
    private List<Member> members = new ArrayList<Member>();

    public void addMember(Member member) {
        this.members.add(member);
        if(member.getTeam() != this) { //ë¬´í•œë£¨í”„ì— ë¹ ì§€ì§€ ì•Šë„ë¡ ì²´í¬
            member.setTeam(this);
        }
    }
}
```

### ì–‘ë°©í–¥ì€ ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ìª½ì´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ë‹¤.

- ì¼ëŒ€ë‹¤ì™€ ëŒ€ëŒ€ì¼ ì—°ê´€ê´€ê³„ëŠ” í•­ìƒ ë‹¤(N)ì— ì™¸ë˜ í‚¤ê°€ ìˆë‹¤.
- ë‹¤ìª½ì¸ `MEMBER` í…Œì´ë¸”ì´ ì™¸ë˜ í‚¤ë¥¼ ê°€ì§€ê³  ìˆìœ¼ë¯€ë¡œ `Member.team`ì´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ë‹¤.
- JPAëŠ” ì™¸ë˜í‚¤ë¥¼ ê´€ë¦¬í•  ë–„ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ë§Œ ì‚¬ìš©í•œë‹¤.
- ì£¼ì¸ì´ ì•„ë‹Œ `Team.members`ëŠ” ì¡°íšŒë¥¼ ìœ„í•œ JPQLì´ë‚˜ ê°ì²´ ê·¸ë˜í”„ë¥¼ íƒìƒ‰í•  ë•Œ ì‚¬ìš©í•œë‹¤.

### ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ëŠ” í•­ìƒ ì„œë¡œë¥¼ ì°¸ì¡°í•´ì•¼ í•œë‹¤.

- ì–´ëŠ í•œ ìª½ë§Œ ì°¸ì¡°í•˜ë©´ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ê°€ ì„±ë¦½ë˜ì§€ ì•ŠëŠ”ë‹¤.
- í•­ìƒ ì„œë¡œ ì°¸ì¡°í•˜ê²Œ í•˜ë ¤ë©´? ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œë¥¼ ì‘ì„±í•œë‹¤. (`setTeam()`, `addMember()`)
- í¸ì˜ ë©”ì†Œë“œëŠ” í•œ ê³³ì—ë§Œ ì‘ì„±í•˜ê±°ë‚˜ ì–‘ìª½ ë‹¤ ì‘ì„±í•  ìˆ˜ ìˆëŠ”ë°, ì–‘ìª½ì— ë‹¤ ì‘ì„± ì‹œ ë¬´í•œë£¨í”„ì— ë¹ ì§€ë¯€ë¡œ ì£¼ì˜í•´ì•¼ í•œë‹¤.
