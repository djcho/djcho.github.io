---
title : "[JPA] ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì˜ ì£¼ì˜ì "
categories:
- JPA
tag :
- [Java, ORM, JPA, Hibernate, Relationship, MappedBy]
toc: true
toc_sticky : true
published : true
date : 2023-01-13 00:00:00
last_modified_at : 2023-01-13 00:00:00
---

ê¹€ì˜í•œë‹˜ì´ ì§€ìŒ, [ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë°] ì±…ì„ ì½ê³  ì •ë¦¬í•œ í•„ê¸°ì…ë‹ˆë‹¤.ğŸ“¢
{: .notice--warning}

# ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì˜ ì£¼ì˜ì 

ë°ì´í„°ë² ì´ìŠ¤ì— ì™¸ë˜ í‚¤ ê°’ì´ ì •ìƒì ìœ¼ë¡œ ì €ì¥ë˜ì§€ ì•Šë‹¤ë©´ ì£¼ì¸ì´ ì•„ë‹Œ ê³³ì—ë§Œ ê°’ì„ ì…ë ¥í–ˆëŠ”ì§€ í™•ì¸í•´ë¼.(ì œë°œ!)



## ì£¼ì¸ì´ ì•„ë‹Œ ê³³ì—ë§Œ ê°’ì„ ì„¤ì •í•  ê²½ìš°

```java
public static void testSaveNonOwner(EntityManager em){
    //íšŒì›1 ì €ì¥
    Member member1 = new Member("member1", "íšŒì›1");
    em.persist(member1);

    //íšŒì›2 ì €ì¥
    Member member2 = new Member("member2", "íšŒì›2");
    em.persist(member2);

    Team team1 = new Team("team1", "íŒ€1");
    //ì£¼ì¸ì´ ì•„ë‹Œ ê³³ë§Œ ì—°ê´€ê´€ê³„ ì„¤ì •
    team1.getMembers().add(member1);
    team1.getMembers().add(member2);

    em.persist(team1);
}
```

**MEMBER í…Œì´ë¸” ì¡°íšŒ ê²°ê³¼**

| MEMBER_ID | USERNAME | TEAM_ID |
| --------- | -------- | ------- |
| member1   | íšŒì›1    | null    |
| member2   | íšŒì›2    | null    |

ìœ„ ì½”ë“œëŠ” ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì¸ `Member.team`ì— ì•„ë¬´ ê°’ë„ ì…ë ¥í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ì™¸ë˜ í‚¤ `TEAM_ID`ì— `team1`ì´ ì•„ë‹Œ `null` ê°’ì´ ì…ë ¥ ë¨



## ê°ì²´ê¹Œì§€ ê³ ë ¤í•œ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„

ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì—ë§Œ ê°’ì„ ì €ì¥í•˜ê³  ì£¼ì¸ì´ ì•„ë‹Œ ê³³ì—ëŠ” ì €ì¥ì„ ì•ˆí•´ë„ ë˜ëŠ”ê°€?

â†’ **No. ê°ì²´ ê´€ì ì—ì„œ ì–‘ìª½ ë°©í–¥ì— ëª¨ë‘ ê°’ì„ ì…ë ¥í•´ì£¼ëŠ” ê²ƒì´ ë°”ëŒì§í•¨**



<u>ì–‘ìª½ ë°©í–¥ ëª¨ë‘ ê°’ì„ ì…ë ¥í•˜ì§€ ì•Šìœ¼ë©´ ê°ì²´ë¥¼ ì‚¬ìš©í•  ë•Œ ë¬¸ì œ ë°œìƒ</u>

```java
public void testìˆœìˆ˜í•œê°ì²´_ì–‘ë°©í–¥(){
  //íŒ€1
  Team team1 = new Team("team1", "íŒ€1");
  Member member1 = new Member("member1", "íšŒì›1");
  Mbmber member2 = new Member("member2", "íšŒì›2");
  
  member1.setTeam(team1); //ì—°ê´€ê´€ê³„ ì„¤ì • member1 -> team1
  member2.setTeam(team1); //ì—°ê´€ê´€ê³„ ì„¤ì • member2 -> team1
  
  List<Member> members = team1.getMembers();
  System.out.println("members.size = " + members.size());
}
//ê²°ê³¼ : members.size = 0
```



ë•Œë¬¸ì—, ê°ì²´ê¹Œì§€ ê³ ë ¤í•˜ë©´ ì–‘ìª½ ë‹¤ ê´€ê³„ë¥¼ ë§ºì–´ì•¼ í•¨

```java
public static void testSave(EntityManager em){
    //íŒ€1 ì €ì¥
    Team team1 = new Team("team1", "íŒ€1");
    em.persist(team1);

    //íšŒì›1 ì €ì¥
    Member member1 = new Member("member1", "íšŒì›1");

    //ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ ì„¤ì •
    member1.setTeam(team1);          //ì—°ê´€ê´€ê³„ ì„¤ì • member1 -> team1
    team1.getMembers().add(member1); //ì—°ê´€ê´€ê³„ ì„¤ì • team1 -> member1
    em.persist(member1);

    //íšŒì›2 ì €ì¥
    Member member2 = new Member("member2", "íšŒì›2");
    member2.setTeam(team1);          //ì—°ê´€ê´€ê³„ ì„¤ì • member2 -> team1
    team1.getMembers().add(member2); //ì—°ê´€ê´€ê³„ ì„¤ì • team1 -> member2
    em.persist(member2);

    em.flush();

    Team findTeam = em.find(Team.class, "team1");
    System.out.println("members.size = " + findTeam.getMembers().size());
}
//ê²°ê³¼ : member.size = 2
```

`team.getMembers().add(member)` ë¥¼ í•˜ì§€ ì•Šì„ ê²½ìš° ê²°ê³¼ëŠ” `member.size = 0` ì´ ì¶œë ¥ ë¨



## ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œ

ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ëŠ” ê²°êµ­ ì–‘ìª½ ë‹¤ ì‹ ê²½ ì¨ì•¼ í•˜ëŠ”ë° ê° ë°©í–¥ë§ˆë‹¤ ì‹ ê²½ ì“°ë‹¤ë³´ë©´ ì‹¤ìˆ˜ë¡œ ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ í˜¸ì¶œí•´ì„œ ì–‘ë°©í–¥ì´ ê¹¨ì§ˆ ìˆ˜ ìˆìŒ

ì–‘ë°©í–¥ ê´€ê³„ì—ì„œ ë‘ ì½”ë“œëŠ” í•˜ë‚˜ì¸ ê²ƒì²˜ëŸ¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•ˆì „

```java
member.setTeam(team);
team.getMembers().add(member);
//ì‹¤ìˆ˜ ì—¬ì§€ê°€ ìˆìŒ
```

```java
public class Member {
    ...
    public void setTeam(Team team){
      this.team = team;
      this.team.getMembers().add(this);
    }
    ...
} //ì‹¤ìˆ˜ë¥¼ ì—†ì•¨ ìˆ˜ ìˆìŒ
```

```java
public static void testSave(EntityManager em){
    //íŒ€1 ì €ì¥
    Team team1 = new Team("team1", "íŒ€1");
    em.persist(team1);

    //íšŒì›1 ì €ì¥
    Member member1 = new Member("member1", "íšŒì›1");
    member1.setTeam(team1);   //ì–‘ë°©í–¥ ì„¤ì •
    em.persist(member1);

    //íšŒì›2 ì €ì¥
    Member member2 = new Member("member2", "íšŒì›2");
    member2.setTeam(team1);   //ì–‘ë°©í–¥ ì„¤ì •
    em.persist(member2);

    em.flush();

    Team findTeam = em.find(Team.class, "team1");
    System.out.println("members.size = " + findTeam.getMembers().size());
}
//ê²°ê³¼ : member.size = 2
```

ì—°ê´€ê´€ê³„ í‰ì˜ ë©”ì†Œë“œ : í•œ ë²ˆì— ì–‘ë°©í–¥ ê´€ê³„ë¥¼ ì„¤ì •í•˜ëŠ” ë©”ì†Œë“œ



## ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œ ì‘ì„± ì‹œ ì£¼ì˜ì‚¬í•­

ì•„ë˜ì™€ ê°™ì€ ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ ìˆìŒ

```java
member1.setTeam(teamA);  //1
member1.setTeam(teamB);  //2
Member findMember = teamA.getMember(); //íŒ€ì´ Bë¡œ ë³€ê²½ ë˜ì—ˆìŒì—ë„ AíŒ€ì— member1ì´ ì—¬ì „íˆ ì¡°íšŒ ë¨
```

<p align="center">
  <img alt="img-name" src="https://user-images.githubusercontent.com/13410737/212363085-97d8be60-e426-420f-a06a-2e3f5056eff2.png">
  <br>
    <em>ì‚­ì œë˜ì§€ ì•Šì€ ê´€ê³„</em>
</p>



ì—°ê´€ê´€ê³„ë¥¼ ë³€ê²½í•  ë•ŒëŠ” ê¸°ì¡´ ê°ì²´ì™€ì˜ ê´€ê³„ë¥¼ ì œê±°í•´ì¤˜ì•¼ í•œë‹¤.

```java
public void setTeam(Team team){
    //ê¸°ì¡´ íŒ€ê³¼ ê´€ê³„ë¥¼ ì œê±°
    if(this.team != null){
      this.team.getMembers().remove(this);
    }
    this.team = team;
    team.getMembers().add(this);
}
```

<u>ì–‘ë°©í–¥ ê´€ê³„ëŠ”</u> ì„œë¡œ ë‹¤ë¥¸ ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ 2ê°œë¥¼ ì–‘ë°©í–¥ì¸ ê²ƒì²˜ëŸ¼ ë³´ì´ê²Œ í•˜ë ¤ê³  **<u>ë¹„ìš©ì´ ë§ì´ ë“¬, ì–‘ë°©í–¥ì„ ì‚¬ìš©í•˜ë ¤ê±°ë“  ë¡œì§ì„ ê²¬ê³ í•˜ê²Œ ì‘ì„±í•´ì•¼ í•¨</u>**

> **ğŸ’¡ Tip.**
>
> ì‚­ì œë˜ì§€ ì•Šì€ ê´€ê³„ì—ì„œ `teamA` â†’ `member` ê´€ê³„ê°€ ì œê±°ë˜ì§€ ì•Šì•„ë„ ë°ì´í„°ë² ì´ìŠ¤ ì™¸ë˜ í‚¤ë¥¼ ë³€ê²½í•˜ëŠ” ë°ëŠ” ë¬¸ì œê°€ ì—†ë‹¤. <u>`Team.members`ëŠ” ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì´ë‹¤.</u> ë¬¸ì œëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ì•„ì§ ìœ ì§€ë˜ëŠ” ìƒíƒœì—ì„œ `teamA`ì˜ `getMembers()`ë¥¼ í˜¸ì¶œí•˜ë©´ `member1`ì´ ë°˜í™˜ëœë‹¤ëŠ” ì ì´ë‹¤. ë”°ë¼ì„œ ë³€ê²½ëœ ì—°ê´€ê´€ê³„ëŠ” ê¸°ì¡´ ê´€ê³„ë¥¼ ì œê±°í•˜ëŠ” ê²ƒì´ ì•ˆì „í•˜ë‹¤.



## ì •ë¦¬

ë‹¨ë°©í–¥ ë§¤í•‘ê³¼ ë¹„êµí•´ ì–‘ë°©í–¥ ë§¤í•‘ì€ ë³µì¡í•¨, ì£¼ì¸ ì„¤ì •í•´ì•¼ í•˜ê³ , ë¡œì§ ê´€ë¦¬ í•´ì•¼ í•¨

ì—°ê´€ê´€ê³„ê°€ í•˜ë‚˜ì´ì ì–¸ì œë‚˜ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì¸ ë‹¨ë°©í–¥ ê´€ê³„ì— ì£¼ì¸ì´ ì•„ë‹Œ ì—°ê´€ê´€ê³„ë¥¼ ì¶”ê°€í–ˆì„ ë¿

**â†’ ì–‘ë°©í–¥ì˜ ì¥ì ì€ ë°˜ëŒ€ë°©í–¥ìœ¼ë¡œ ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ ê¸°ëŠ¥ì´ ì¶”ê°€ëœ ê²ƒë¿ì´ë‹¤ !**



### 3ì¤„ ìš”ì•½

- ë‹¨ë°©í–¥ ë§¤í•‘ë§Œìœ¼ë¡œ í…Œì´ë¸”ê³¼ ê°ì²´ì˜ ì—°ê´€ê´€ê³„ ë§¤í•‘ì€ ì´ë¯¸ ì™„ë£Œ ë¨
- ë‹¨ë°©í–¥ì„ ì–‘ë°©í–¥ìœ¼ë¡œ ë§Œë“¤ë©´ ë°˜ëŒ€ë°©í–¥ìœ¼ë¡œ ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ ê¸°ëŠ¥ì´ ì¶”ê°€ ë¨
- ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¥¼ ë§¤í•‘í•˜ë ¤ë©´ ê°ì²´ì—ì„œ ì–‘ìª½ ë°©í–¥ì„ ëª¨ë‘ ê´€ë¦¬í•´ì•¼ í•¨



> **ğŸ’¡ Tip.  ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì„ ì •í•˜ëŠ” ê¸°ì¤€**
>
> ë‹¨ë°©í–¥ì€ í•­ìƒ ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ê³³ì„ ê¸°ì¤€ìœ¼ë¡œ ë§¤í•‘í•˜ë©´ ëœë‹¤. í•˜ì§€ë§Œ ì–‘ë°©í–¥ì€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸(Owner)ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì¸í•´ ì˜¤í•´ê°€ ìˆì„ ìˆ˜ ìˆë‹¤. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ìƒ ë” ì¤‘ìš”í•˜ë‹¤ê³  ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ìœ¼ë¡œ ì„ íƒí•˜ë©´ ì•ˆëœë‹¤. ë¹„ì¦ˆë‹ˆìŠ¤ ì¤‘ìš”ë„ë¥¼ ë°°ì œí•˜ê³  ë‹¨ìˆœíˆ ì™¸ë˜ í‚¤ ê´€ë¦¬ì ì •ë„ì˜ ì˜ë¯¸ë§Œ ë¶€ì—¬í•´ì•¼ í•œë‹¤.
>
> ì˜ˆë¥¼ ë“¤ì–´ ìë™ì°¨ì˜ ì°¨ì²´ì™€ ë°”í€´ë¥¼ ìƒê°í•´ë³´ë©´ ë°”í€´ê°€ ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ë‹¤ ìª½ì´ë‹¤. ë”°ë¼ì„œ ë°”í€´ê°€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ëœë‹¤. ì°¨ì²´ê°€ ë” ì¤‘ìš”í•œ ê²ƒ ê°™ì•„ ë³´ì´ì§€ë§Œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ ë‹¨ìˆœíˆ ì™¸ë˜ í‚¤ë¥¼ ë§¤í•‘í•œ ë°”í€´ë¥¼ ì„ íƒí•˜ë©´ ëœë‹¤. ë”°ë¼ì„œ **ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ ì™¸ë˜ í‚¤ì˜ ìœ„ì¹˜ì™€ ê´€ë ¨í•´ì„œ ì •í•´ì•¼ì§€ ë¹„ì¦ˆë‹ˆìŠ¤ ì¤‘ìš”ë„ë¡œ ì ‘ê·¼í•˜ë©´ ì•ˆëœë‹¤.**



âš ï¸ ì–‘ë°©í–¥ ë§¤í•‘ ì‹œì—ëŠ” ë¬´í•œ ë£¨í”„ì— ë¹ ì§€ì§€ ì•Šê²Œ ì¡°ì‹¬í•´ì•¼ í•¨. `Member.toString()` ì—ì„œ `getTeam()` í˜¸ì¶œí•˜ê³  `Team.String()`ì—ì„œ `getMember()` í˜¸ì¶œ ì‹œ ë°œìƒ í•¨. Lombok ì‚¬ìš©ì‹œ íŠ¹íˆ ì£¼ì˜í•´ì•¼ í•˜ê³  JSON ë³€í™˜í•  ë•Œ ìì£¼ ë°œìƒí•˜ë‹ˆ ë¬´í•œë£¨í”„ì— ë¹ ì§€ì§€ ì•Šë„ë¡ ë°©ì–´í•´ì£¼ëŠ” ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì.
{: .notice--warning}

